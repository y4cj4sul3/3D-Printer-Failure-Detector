<!DOCTYPE html>
<html>
  <head>
    <title>3D Printer Failure Detector</title>
  </head>
  <body>
    <h1>3D Printer Failure Detector</h1>

    <template id="printer_visualizer_template">
      <div class="printer_visualizer">
        <h3 class="printer_name">Printer Name</h3>
        <h4 class="printjob_name">Print Job Name</h4>
        <p>
          Printer State: <span class="printer_state"></span>, Print Job State:
          <span class="printjob_state"></span>
        </p>
        <img class="input_img" />
        <img class="sim_img" />
        <img class="predict_img" />
        <p>Result: <span class="result"></span></p>
      </div>
    </template>

    <script src="printer_model.js" type="text/javascript"></script>

    <script>
      printer_info = {};

      function updatePrinterInfo(new_info) {
        // set expired
        for (var key in printer_info) {
          printer_info[key].isExpired = true;
        }
        // update printer info
        for (var key in new_info) {
          if (key in printer_info) {
            printer_info[key].update(new_info[key]);
          } else {
            printer_info[key] = new PrinterModel(new_info[key]);
          }
        }
        // check expiration
        for (var key in printer_info) {
          if (printer_info[key].isExpired) {
            printer_info[key].expired();
          }
        }
      }

      var xhttp = new XMLHttpRequest();
      xhttp.onload = function () {
        if (xhttp.status == 200) {
          var data = JSON.parse(xhttp.responseText);
          console.log(data);
          updatePrinterInfo(data);
        }
      };

      function getPrinterInfo() {
        xhttp.open("GET", "/get_printer_info", true);
        xhttp.send();
      }

      //  listen for update
      getPrinterInfo();
      setInterval(getPrinterInfo, 10000);
    </script>
  </body>
</html>
